<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>学ぶ | Adventure Game Page</title>
    <!-- Modern UI Theme -->
    <link rel="stylesheet" href="styles/modern.css?v=1" />
    <link rel="stylesheet" href="styles/common.css" />
    <style>
      .learn-main {
        max-width: 1000px;
        margin: 0 auto;
        padding: var(--space-xl) var(--space-md);
      }
      
      .intro-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin-bottom: var(--space-xl);
      }
      
      .intro-card h2 {
        font-size: var(--text-xl);
        margin: 0 0 var(--space-sm);
      }
      
      .intro-card p {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        margin: 0;
      }
      
      .examples-grid {
        display: grid;
        gap: var(--space-md);
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      
      .example-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      
      .example-header {
        padding: var(--space-md);
        border-bottom: 1px solid var(--border-subtle);
      }
      
      .example-header h3 {
        font-size: var(--text-base);
        font-weight: 600;
        margin: 0 0 var(--space-xs);
      }
      
      .example-badge {
        font-size: var(--text-xs);
        color: var(--text-muted);
      }
      
      .example-code {
        flex: 1;
        background: var(--bg-primary);
        padding: var(--space-md);
        overflow: auto;
        max-height: 280px;
        font-family: var(--font-mono);
        font-size: var(--text-xs);
        line-height: var(--line-height-relaxed);
        color: var(--text-secondary);
      }
      
      .example-footer {
        padding: var(--space-md);
        border-top: 1px solid var(--border-subtle);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="app-header">
      <a class="header-brand" href="index.html">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        <span>トップ</span>
      </a>
      <h1 class="header-title">学ぶ</h1>
      <nav class="nav-tabs">
        <a class="nav-tab" href="index.html">ホーム</a>
        <a class="nav-tab active" href="learn.html">学ぶ</a>
        <a class="nav-tab" href="admin.html">管理</a>
        <a class="nav-tab" href="play.html">プレイ</a>
      </nav>
    </header>

    <main class="learn-main">
      <!-- Intro -->
      <section class="intro-card">
        <h2>インタラクティブなサンプル</h2>
        <p>各カードの「読み込んでプレイ」を押すと、サンプルが保存され <code>play.html</code> で即実行できます。</p>
      </section>

      <!-- Examples Grid -->
      <section class="examples-grid">
        <article class="example-card">
          <div class="example-header">
            <h3>基本分岐</h3>
            <span class="example-badge">ノード / 選択肢</span>
          </div>
          <pre class="example-code" id="code-basic"></pre>
          <div class="example-footer">
            <button class="btn btn-primary w-full" id="btn-basic">読み込んでプレイ</button>
          </div>
        </article>

        <article class="example-card">
          <div class="example-header">
            <h3>インベントリ</h3>
            <span class="example-badge">add_item / use_item</span>
          </div>
          <pre class="example-code" id="code-inventory"></pre>
          <div class="example-footer">
            <button class="btn btn-primary w-full" id="btn-inventory">読み込んでプレイ</button>
          </div>
        </article>

        <article class="example-card">
          <div class="example-header">
            <h3>変数と条件分岐</h3>
            <span class="example-badge">set_variable / variable_equals</span>
          </div>
          <pre class="example-code" id="code-variables"></pre>
          <div class="example-footer">
            <button class="btn btn-primary w-full" id="btn-variables">読み込んでプレイ</button>
          </div>
        </article>

        <article class="example-card">
          <div class="example-header">
            <h3>画像とサウンド</h3>
            <span class="example-badge">image / play_bgm / play_sfx</span>
          </div>
          <pre class="example-code" id="code-media"></pre>
          <div class="example-footer">
            <button class="btn btn-primary w-full" id="btn-media">読み込んでプレイ</button>
          </div>
        </article>
      </section>
    </main>

    <script src="scripts/storage.js"></script>
    <script>
      // サンプル定義（エンジン形式）
      const EXAMPLES = {
        basic: {
          title: '基本分岐', start: 'start',
          nodes: {
            start: { text: '最初の部屋。', choices: [ { text: '次へ', to: 'next' } ] },
            next:  { text: 'おめでとう！', choices: [ { text: '最初に戻る', to: 'start' } ] }
          }
        },
        inventory: {
          title: 'インベントリ', start: 'start',
          nodes: {
            start: { text: '剣を拾いますか？', choices: [ { text: '拾う', to: 'got' }, { text: 'やめる', to: 'end' } ], actions:[ { type:'add_item', itemId:'sword', quantity:1 } ] },
            got:   { text: '剣を手に入れた！', choices: [ { text:'使う', to:'use' } ] },
            use:   { text: '剣を振る！', choices: [ { text:'終わる', to:'end' } ], actions:[ { type:'use_item', itemId:'sword', effect:{ type:'show_text', text:'華麗な一撃！' } } ] },
            end:   { text: 'おしまい。', choices: [ { text:'最初へ', to:'start' } ] }
          }
        },
        variables: {
          title: '変数と条件', start: 'start',
          nodes: {
            start: { text: 'スコアを+1します。', choices: [ { text:'加算', to:'next' } ], actions:[ { type:'set_variable', key:'score', operation:'add', value:1 } ] },
            next:  { text: 'score が 1 以上なら扉が開く。', choices: [ { text:'扉へ', to:'door' } ] },
            door:  { text: '扉の前。', choices: [ { text:'開ける', to:'open', conditions:[ { type:'variable_equals', key:'score', operator:">=", value:1 } ] } ] },
            open:  { text: '開いた！', choices: [ { text:'最初へ', to:'start' } ] }
          }
        },
        media: {
          title: '画像とサウンド', start: 'start',
          nodes: {
            start: { title:'森の入口', image:'https://placehold.co/1200x700?text=Forest+Entrance', text: '音楽が始まる。', choices: [ { text:'進む', to:'deep' } ], actions:[ { type:'play_bgm', url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', volume:0.6, loop:true } ] },
            deep:  { title:'森の奥', image:'https://placehold.co/1200x700?text=Forest+Deep', text: 'ガサガサ…', choices: [ { text:'音', to:'sfx' }, { text:'やめる', to:'stop' } ] },
            sfx:   { text: '効果音！', choices: [ { text:'戻る', to:'deep' } ], actions:[ { type:'play_sfx', url:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', volume:0.9 } ] },
            stop:  { text: '音楽を止める。', choices: [ { text:'最初へ', to:'start' } ], actions:[ { type:'stop_bgm', fadeOut:true } ] }
          }
        }
      };

      function pretty(obj){ return JSON.stringify(obj, null, 2); }
      function mountCodes(){
        document.getElementById('code-basic').textContent = pretty(EXAMPLES.basic);
        document.getElementById('code-inventory').textContent = pretty(EXAMPLES.inventory);
        document.getElementById('code-variables').textContent = pretty(EXAMPLES.variables);
        document.getElementById('code-media').textContent = pretty(EXAMPLES.media);
      }
      function loadAndPlay(example){
        try {
          StorageUtil.saveJSON('agp_game_data', example);
          window.location.href = 'play.html';
        } catch(e){ alert('読み込みに失敗しました'); }
      }
      document.addEventListener('DOMContentLoaded', () => {
        mountCodes();
        document.getElementById('btn-basic').addEventListener('click', () => loadAndPlay(EXAMPLES.basic));
        document.getElementById('btn-inventory').addEventListener('click', () => loadAndPlay(EXAMPLES.inventory));
        document.getElementById('btn-variables').addEventListener('click', () => loadAndPlay(EXAMPLES.variables));
        document.getElementById('btn-media').addEventListener('click', () => loadAndPlay(EXAMPLES.media));
      });
    </script>
  </body>
</html>
