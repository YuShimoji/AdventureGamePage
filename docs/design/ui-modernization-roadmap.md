# UI刷新および情報設計ロードマップ

## 改修ゴール
- 管理画面・プレイ画面ともに **直感的でモダンなUI** を実現し、操作学習コストを削減する。
- ブロック単位で差し替え可能な **モジュラ構造** を構築し、将来のWikiや外部ツール連携を容易にする。
- ゲームデータ（ストーリー分岐 / 所持品 / メモ等）を単一のデータ層で扱えるよう整理し、**一元的なデータ管理** を提供する。

## UI改修の段階プラン
| フェーズ | 主な対象 | 改修内容 | 完了判定 |
| --- | --- | --- | --- |
| Phase 0 | 既存不具合 | 文字化け修正、テーマ/アイコンの再適用 | UI文言が正しく表示される |
| Phase 1 | レイアウト基盤 | CSS設計の再編（Atomic Designベースの命名）、レスポンシブ対応整理 | 新レイアウトCSSが`admin.html`/`play.html`で共通利用 |
| Phase 2 | 編集体験 | サイドバーを機能別カードに分割、ドラッグ&ドロップ/ショートカット導線整理 | 操作手順書を更新し、利用テストで許容時間内に操作完了 |
| Phase 3 | 高度機能 | Mermaidプレビュー、Wiki面との連携UI、設定パネルの段階開閉 | 機能ON/OFF時のUI崩れがない |

## コンポーネント方針
- **レイアウト**: `Layout/Header`, `Layout/Sidebar`, `Layout/Content` の3カラム構成をベースに、カードUIとフローティングツールバーをコンポーネント化。
- **編集パネル**: `EditorPane`（本文）、`NodeManager`（分岐編集）、`AssetPanel`（所持品・メモ）へ分割。各パネルはイベントバスで状態同期。
- **共通パーツ**: ボタン、トグル、バッジなどを`styles/components/`配下にカプセル化し、テーマ切り替え時にトークンベースでスタイル適用。

## データレイヤ再設計
- **統一データモデル**: `GameSchema`（ノード / 選択肢 / アイテム / キャラクター / 用語辞典）を定義し、`scripts/storageProviders.js`から参照。
- **ドメインモジュール**: `scripts/domain/`配下へ`story`, `inventory`, `lore`などのモジュールを追加して関心事を分離。
- **同期戦略**: IndexedDBを主導としつつ、ローカルストレージはバックアップ用途に。`storageBridge.js`をハブとして、将来のクラウド同期APIを差し込めるインターフェースに拡張。

## Wiki機能の統合設計
- **目的**: プレイ中に遭遇した用語・キャラクター・エリア情報を蓄積し、検索・タグ付け・AI要約を行える辞書ビューを提供。
- **実装段階**:
  1. `LoreRepository`（IndexedDB）を用意し、ゲームデータから自動抽出。
  2. `WikiPanel`（管理画面）でタグ編集・リンク付与を行う。
  3. `play.html`側にコンパクトなWikiサイドパネルを配置し、進行中に参照できるようにする。
- **ライティングエディターツールとの連携**: エディターツールはWikiガジェットを組み込み、`LoreRepository`を共有データストアとして再利用。API境界を`/domain/wiki`で揃え、スタンドアロン動作と統合運用の双方を許容。

## 情報設計とドキュメント更新方針
- `docs/specs/game-data-schema.md`を拡張し、Wiki/所持品/タグのスキーマを追記。
- `docs/test_plan.md`にUIリニューアル用のUXテストケース（タスク完了時間・操作数計測）を追加。
- `docs/issues/`配下へフェーズ別Issueテンプレートを作成し、GitHub Projectと連動。
- `AI_CONTEXT.md`の「次の一手」にUI刷新ロードマップとデータモジュール再構成を追記し、重要変更点を常時同期。

## 今後の着手優先度候補
1. 文字化け修正とテーマ再適用のPoC作成
2. コンポーネント化のためのスタイル命名規則決定
3. `GameSchema`ドラフト設計と現行データの整合性確認
4. Wiki機能を支えるIndexedDBテーブル設計とモック実装
