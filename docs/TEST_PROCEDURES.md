# テスト手順と期待される結果

## 📋 テスト概要

このドキュメントでは、Adventure Game Pageプロジェクトのテスト手順と期待される結果について説明します。テストは以下のカテゴリに分類されます：

- **機能テスト**: 各機能の正常動作確認
- **統合テスト**: コンポーネント間の連携確認
- **回帰テスト**: 既知のバグ修正確認
- **パフォーマンステスト**: 応答性・安定性確認

## 🚀 テスト環境セットアップ

### 1. 開発サーバー起動

```bash
npm run dev
# サーバーが起動し、ポート番号が表示される（例: 8080）
```

### 2. テストページアクセス

- メイン: `http://127.0.0.1:{PORT}/`
- 管理画面: `http://127.0.0.1:{PORT}/admin.html`
- プレイ画面: `http://127.0.0.1:{PORT}/play.html`
- テスト画面: `http://127.0.0.1:{PORT}/test-rpg.html`
- テスト実行: `http://127.0.0.1:{PORT}/tests/test.html`

## 🧪 機能テスト

### 1. スタートページ（index.html）

#### テスト手順

1. `http://127.0.0.1:{PORT}/` にアクセス
2. ページが正常に読み込まれることを確認
3. ナビゲーションリンクが機能することを確認

#### 期待される結果

- ✅ ページタイトル「Adventure Game Page」が表示
- ✅ 「管理（執筆エディタ）」リンクが `admin.html` へ遷移
- ✅ 「プレイ」リンクが `play.html` へ遷移
- ✅ 概要説明文が表示
- ✅ 使い方ガイドが表示

### 2. 管理画面（admin.html）

#### テスト手順

1. `http://127.0.0.1:{PORT}/admin.html` にアクセス
2. エディタ領域が表示されることを確認
3. サイドバーがトグル可能であることを確認
4. 文字数カウンタが動作することを確認

#### 期待される結果

- ✅ ページタイトル「管理（Zenライク執筆エディタ）」が表示
- ✅ 中央に contenteditable なエディタ領域が存在
- ✅ 右側にサイドバーが表示（初期状態: 表示）
- ✅ ヘッダーに文字数カウンタが表示
- ✅ エディタが空のとき、`config.js` で定義されたプレースホルダー（例: 「入力を開始……」）が薄く表示される（実テキストとしては挿入されない）
- ✅ サイドバートグルボタン（☰）が機能
- ✅ テーマ設定ボタン（🎨）が機能

#### エディタ機能テスト

1. エディタ領域をクリック
2. テキストを入力
3. 文字数カウンタが更新されることを確認
4. テキストを選択し、書式ボタン（B/I/U）をクリック

#### 期待される結果

- ✅ 入力したテキストが表示
- ✅ 文字数がリアルタイムで更新
- ✅ 太字・斜体・下線が適用可能
- ✅ Zenモード（F11風）がトグル可能

### 3. プレイ画面（play.html）

#### テスト手順

1. `http://127.0.0.1:{PORT}/play.html` にアクセス
2. サンプルゲームが読み込まれることを確認
3. 選択肢をクリックしてゲームが進行することを確認

#### 期待される結果

- ✅ ゲームタイトルが表示
- ✅ シーン本文が表示
- ✅ 選択肢ボタンが表示
- ✅ 選択肢クリックで次のシーンへ遷移
- ✅ 戻る・進むボタンが機能
- ✅ リセットボタンが機能

### 4. テスト画面（test-rpg.html）

#### テスト手順

1. `http://127.0.0.1:{PORT}/test-rpg.html` にアクセス
2. RPGサンプルゲームが読み込まれることを確認
3. ゲームをプレイして全機能をテスト

#### 期待される結果

- ✅ 「森の冒険者」タイトルが表示
- ✅ インベントリシステムが機能
- ✅ アイテム使用アクションが機能
- ✅ 変数システムが機能
- ✅ 条件分岐が正しく動作
- ✅ 画像表示が機能

## 🧪 統合テスト

### 1. ゲーム作成・プレイフロー

#### テスト手順

1. 管理画面で簡単なゲームを作成
2. ノードエディタでノードを追加
3. ゲームデータを保存
4. プレイ画面で保存したゲームを読み込み

#### 期待される結果

- ✅ 管理画面での編集が保存可能
- ✅ 保存したゲームがプレイ画面で読み込み可能
- ✅ 作成した分岐が正しく動作

### 2. データ永続化テスト

#### テスト手順

1. 管理画面でテキストを入力・保存
2. ブラウザをリロード
3. データが復元されることを確認

#### 期待される結果

- ✅ 入力テキストが維持される
- ✅ ゲーム進行状態が保存される
- ✅ 設定が保持される

### 3. クロスブラウザ互換性

#### テスト手順

- Chrome, Firefox, Safari, Edge で各画面をテスト

#### 期待される結果

- ✅ 全ブラウザで正常動作
- ✅ レイアウトが崩れない
- ✅ 機能が正常に動作

## 🐛 回帰テスト（既知バグ修正確認）

### 1. エディタ表示問題

**問題**: 管理画面のエディタが表示されない
**修正**: admin-boot.js の導入

#### テスト手順

1. 管理画面を新規タブで開く
2. ブラウザコンソールを確認
3. エディタ領域が表示されることを確認

#### 期待される結果

- ✅ エラーメッセージなし
- ✅ エディタ領域が正常表示
- ✅ 初期化メッセージがコンソールに表示

### 2. 画像表示機能

**問題**: ノードの画像が表示されない
**修正**: sceneImageEl の渡し漏れ修正

#### テスト手順

1. テスト画面でRPGサンプルをプレイ
2. 画像付きノードに到達

#### 期待される結果

- ✅ ノード画像が正常表示
- ✅ 画像が適切なサイズで表示

### 3. アクション編集UI

**問題**: ノードエディタにアクション編集UIがない
**修正**: admin.html にアクション編集フィールド追加

#### テスト手順

1. 管理画面のノードエディタを開く
2. ノードを選択
3. 「アクション」セクションを確認

#### 期待される結果

- ✅ アクション編集UIが表示
- ✅ アクションの追加・編集が可能

## ⚡ パフォーマンステスト

### 1. 読み込み時間テスト

#### テスト手順

1. 各ページの初回読み込み時間を計測
2. ブラウザ開発者ツールのNetworkタブを使用

#### 期待される結果

- ✅ 初回読み込み: 3秒以内
- ✅ キャッシュ後: 1秒以内
- ✅ 合計バンドルサイズ: 500KB以内

### 2. ゲーム実行パフォーマンス

#### テスト手順

1. 大規模なゲームデータ（50ノード以上）を作成
2. 高速でノード遷移を実行
3. メモリ使用量を確認

#### 期待される結果

- ✅ ノード遷移: 100ms以内
- ✅ メモリリークなし
- ✅ 60FPS維持

## 🔧 自動テスト実行

### ブラウザテストスイート

#### テスト手順

```bash
# テスト実行
npm run test

# または手動実行
npm run dev
# ブラウザで http://127.0.0.1:{PORT}/tests/test.html を開く
```

#### 期待される結果

- ✅ Game Engine テスト: 全通過
- ✅ Storage テスト: 全通過
- ✅ Node Editor テスト: 全通過
- ✅ Validator テスト: 全通過
- ✅ Converter テスト: 全通過

### CIテスト

#### テスト手順

```bash
# CI環境向けテスト
npm run test:ci
```

#### 期待される結果

- ✅ サーバー起動確認
- ✅ ページ到達性確認
- ✅ 基本機能テスト実行

## 📊 テスト結果レポート

### 合格基準

- **機能テスト**: 100% 合格
- **統合テスト**: 100% 合格
- **回帰テスト**: 100% 合格
- **パフォーマンス**: 95% 以上の項目が基準内

### テスト結果の記録

```javascript
// テスト結果オブジェクト
const testResults = {
  timestamp: new Date().toISOString(),
  environment: {
    browser: navigator.userAgent,
    url: window.location.href,
    screen: `${screen.width}x${screen.height}`,
  },
  results: {
    functional: { passed: 0, total: 0, items: [] },
    integration: { passed: 0, total: 0, items: [] },
    regression: { passed: 0, total: 0, items: [] },
    performance: { passed: 0, total: 0, items: [] },
  },
  summary: {
    totalPassed: 0,
    totalTests: 0,
    successRate: 0,
    duration: 0,
  },
};
```

## 🚨 テスト失敗時の対応

### 1. スクリーンショット取得

- 失敗時のブラウザ画面をキャプチャ
- コンソールエラーを記録

### 2. ログ収集

- ブラウザコンソールログ
- ネットワークリクエストログ
- パフォーマンスプロファイル

### 3. 環境情報

- ブラウザバージョン
- OS情報
- 画面解像度
- ネットワーク条件

### 4. 再現手順

- 失敗した操作の詳細な手順
- テストデータの状態
- 期待される動作 vs 実際の動作

## 📈 継続的改善

### テストカバレッジ拡張

- 新機能追加時のテストケース追加
- エッジケースのテスト強化
- アクセシビリティテストの追加

### パフォーマンス監視

- Core Web Vitals の測定
- メモリ使用量の長期監視
- バンドルサイズの最適化

---

## ✅ クイックテストチェックリスト

### 基本機能

- [ ] スタートページ表示
- [ ] 管理画面エディタ表示
- [ ] プレイ画面ゲーム実行
- [ ] テスト画面全機能動作

### データ永続化

- [ ] テキスト保存・復元
- [ ] ゲーム状態保存・復元
- [ ] 設定保存・復元

### 高度機能

- [ ] ノードエディタ動作
- [ ] Mermaidプレビュー表示
- [ ] デバッグUI動作
- [ ] テーマ切り替え

### パフォーマンス

- [ ] ページ読み込み3秒以内
- [ ] ゲーム遷移100ms以内
- [ ] メモリリークなし
