# Test Plan

## 目的

サーバー不要のローカル環境で、管理（執筆）とプレイの基本フローが破綻なく動作することを確認する。

## 前提

## 手順

1. `index.html` を開く
   - ヘッダのナビ（管理/プレイ）が表示されること
   - テーマボタンでテーマパネルが表示/非表示できること
2. `admin.html`
   - 初期表示ではヘッダとサイドバーが表示されている（必要に応じてZenモードに切り替え）
   - フローティング操作：Zen切替、サイドバー開閉、テーマパネル開閉ができること
   - エディタが空状態で `config.js` のプレースホルダが表示
   - 空のとき文字数カウントは「0 文字」
   - 入力で文字数カウントが増える（1 文字入力→「1 文字」）
   - フローティング書式バー（B/I/U、左右中央揃え）が機能する
   - ゲームJSONエクスポート/インポート
     - 「ゲームJSONエクスポート」で最小構成の game.json をダウンロードできる
     - 「ゲームJSONインポート」で仕様ドラフトのJSONを読み込み、変換・保存（`APP_CONFIG.storage.keys.gameData`）
   - メモ：メモパネル表示、ラベル/本文入力→追加され一覧に表示、順位の変更、削除
   - 並べ替え：作成日時（新→旧/旧→新）、順位（高→低/低→高）の切替が反映
   - 保存先選択：サイドバーの「保存先（ストレージ）」で IndexedDB/LocalStorage を切替可能
   - 保存一覧：ボタンを押すと一覧表示（タイトル/日時/保存先/サイズ/抜粋）され、開く・エクスポート・削除が動作
   - シンプル/完全保存後に保存一覧へ反映される（既定は IndexedDB）
   - ノード編集（MVP）
     - 「取込」で現在のゲームデータを取り込み、ノード一覧に反映される
     - ノード選択プルダウンにIDが列挙される
     - 「ノード追加」で `node:new` をベースに重複しないIDが採番される
     - 「ノード削除」で選択中のノードが削除される
     - ID/タイトル/本文の編集が即時に反映される
     - 選択肢の追加/削除と label/target の編集が反映される
     - 「検証」でエラー/警告が検証パネルに表示される（未解決target/到達不能/行き止まり 等）
     - 「適用保存」でエンジン形式に正規化され、`APP_CONFIG.storage.keys.gameData` に保存→play.html で反映される
     - 「JSON出力」でドラフト仕様の `game-spec.json` がダウンロードされる

   - ノード編集（UX強化）
     - 未保存バナー: 任意の変更で表示、保存で消える（`Ctrl+S`でも保存可）
     - 未解決target一覧: 未解決が0件なら非表示、1件以上で一覧表示し、クリックで該当ノードへ移動
     - ショートカット: `Ctrl+Enter` ノード追加、`Alt+Enter` 選択肢追加、`Delete` ノード削除（確認あり）
     - 選択肢の並べ替え: 行の `↑`/`↓` ボタンで順序が更新される
     - IDリネーム時の参照更新: 変更確認後、choices.target が更新される（キャンセルすると元に戻す）
     - 部分エクスポート: 複数ノードを選択→「選択からエクスポート」で到達サブグラフが `game-spec.partial.json` で保存され、meta.start は選択先頭

## ブラウザユニットテスト（Mocha + Chai）

1. ローカルHTTPサーバーを起動
   - `npm run dev`（起動ログにURLが表示される）
2. ブラウザで「起動ログに表示されたURL」に `/tests/test.html` を付けて開く
   - Converters: 仕様→エンジン正規化、エンジン→仕様再変換の相互変換
   - Validator: 妥当な仕様の成功、未解決 target の警告、start 不足や重複IDの検出
   - StorageProvider/StorageBridge: simple/full 保存と取得、スナップショットの作成と一覧
   - GameEngine: start ノードの描画、`setNode()` による遷移、進行の保存/復帰
     - スナップショットの「読込」で状態が復元される
     - スナップショットの「削除」で一覧から消える
3. `play.html`
   - サンプルゲームの最初のシーンが表示される
   - 選択肢をクリックで遷移する
   - シーン画像（`node.image`）がある場合、画像が表示される
   - 条件付き選択肢（`choices[].conditions`）が状態（所持品/変数）に応じて表示される
   - オーディオアクション（`play_bgm` / `play_sfx` / `stop_bgm`）でエラーが発生しない（ブラウザの音声許可後に再生される）

## 期待結果

全手順でエラーが出ないこと。UI が崩れないこと。保存先切替（IndexedDB/LocalStorage）と保存一覧が正しく動作すること。
