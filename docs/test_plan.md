# Test Plan

## 目的
サーバー不要のローカル環境で、管理（執筆）とプレイの基本フローが破綻なく動作することを確認する。

## 前提

## 手順
1. `index.html` を開く
   - ヘッダのナビ（管理/プレイ）が表示されること
   - テーマボタンでテーマパネルが表示/非表示できること
2. `admin.html`
   - 初期表示は Zen モードでヘッダ・サイドバーが非表示
   - フローティング操作：🧘でZen切替、☰でサイドバー開閉、🎨でテーマパネル開閉
   - エディタが空状態で `config.js` のプレースホルダが表示
   - 空のとき文字数カウントは「0 文字」
   - 入力で文字数カウントが増える（1 文字入力→「1 文字」）
   - フローティング書式バー（B/I/U、左右中央揃え）が機能する
   - ゲームJSONエクスポート/インポート
     - 「ゲームJSONエクスポート」で最小構成の game.json をダウンロードできる
     - 「ゲームJSONインポート」で仕様ドラスターのJSONを読み込み、変換・保存（localStorage: `agp_game_data`）
   - メモ：📝でメモパネル表示、ラベル/本文入力→追加され一覧に表示、順位の変更、削除
   - 並べ替え：作成日時（新→旧/旧→新）、順位（高→低/低→高）の切替が反映
   - 保存先選択：サイドバーの「保存先（ストレージ）」で IndexedDB/LocalStorage を切替可能
   - 保存一覧：ボタンを押すと一覧表示（タイトル/日時/保存先/サイズ/抜粋）され、開く・エクスポート・削除が動作
   - シンプル/完全保存後に保存一覧へ反映される（既定は IndexedDB）
   

    - ノード編集（MVP）
      - 「取込（agp_game_data）」で現在のゲームデータを取り込み、ノード一覧に反映される
      - ノード選択プルダウンにIDが列挙される
      - 「ノード追加」で `node:new` をベースに重複しないIDが採番される
      - 「ノード削除」で選択中のノードが削除される
      - ID/タイトル/本文の編集が即時に反映される
      - 選択肢の追加/削除と label/target の編集が反映される
      - 「検証」でエラー/警告が検証パネルに表示される（未解決target/到達不能/行き止まり 等）
      - 「適用保存」でエンジン形式に正規化され、`agp_game_data` に保存→play.html で反映される
      - 「JSON出力」でドラフト仕様の `game-spec.json` がダウンロードされる

    - ノード編集（UX強化）
      - 未保存バナー: 任意の変更で表示、保存で消える（`Ctrl+S`でも保存可）
      - 未解決target一覧: 未解決が0件なら非表示、1件以上で一覧表示し、クリックで該当ノードへ移動
      - ショートカット: `Ctrl+Enter` ノード追加、`Alt+Enter` 選択肢追加、`Delete` ノード削除（確認あり）
      - 選択肢の並べ替え: 行の `↑`/`↓` ボタンで順序が更新される
      - IDリネーム時の参照更新: 変更確認後、choices.target が更新される（キャンセルすると元に戻す）
      - 部分エクスポート: 複数ノードを選択→「選択からエクスポート」で到達サブグラフが `game-spec.partial.json` で保存され、meta.start は選択先頭

## ブラウザユニットテスト（Mocha + Chai）
1. ローカルHTTPサーバーを起動
   - `py -3 -m http.server 5500`
2. ブラウザで `http://127.0.0.1:5500/tests/test.html` を開く
   - Converters: 仕様→エンジン正規化、エンジン→仕様再変換の相互変換
   - Validator: 妥当な仕様の成功、未解決 target の警告、start 不足や重複IDの検出
   - StorageProvider/StorageBridge: simple/full 保存と取得、スナップショットの作成と一覧
   - GameEngine: start ノードの描画、`setNode()` による遷移、進行の保存/復帰
       - スナップショットの「読込」で状態が復元される
       - スナップショットの「削除」で一覧から消える
3. `play.html`
   - サンプルゲームの最初のシーンが表示される
   - 選択肢をクリックで遷移する

## 期待結果
全手順でエラーが出ないこと。UI が崩れないこと。保存先切替（IndexedDB/LocalStorage）と保存一覧が正しく動作すること。
