<!doctype html>
<html lang="ja">
  <head>
    <script src="scripts/header.js"></script>
    <script>
      HeaderUtils.generateHead('Adventure Game Page - Unified');
    </script>
    <style>
      /* Tab navigation styles */
      .app-tabs {
        display: flex;
        gap: 8px;
        padding: 8px 16px;
        background: var(--surface);
        border-bottom: 1px solid var(--border-color);
        overflow-x: auto;
        position: sticky;
        top: 60px;
        z-index: 50;
      }
      .app-tab {
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: transparent;
        color: var(--text-muted);
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
      }
      .app-tab:hover {
        background: var(--surface-hover);
        color: var(--text-color);
      }
      .app-tab.active {
        background: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
      }
      .app-view {
        display: none;
      }
      .app-view.active {
        display: block;
      }
      .loading-indicator {
        text-align: center;
        padding: 40px;
        color: var(--text-muted);
      }
    </style>
  </head>
  <body>
    <script>
      const header = HeaderUtils.generateHeader('Adventure Game Page', [
        { text: 'ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ç‰ˆ', href: 'index.html' }
      ]);
      document.body.insertBefore(header, document.body.firstChild);
    </script>

    <!-- Tab Navigation -->
    <nav class="app-tabs">
      <button class="app-tab active" data-view="home">ğŸ  ãƒ›ãƒ¼ãƒ </button>
      <button class="app-tab" data-view="features">âœ¨ æ©Ÿèƒ½ä¸€è¦§</button>
      <button class="app-tab" data-view="play">ğŸ® ãƒ—ãƒ¬ã‚¤</button>
      <button class="app-tab" data-view="admin">âœï¸ ç®¡ç†</button>
      <button class="app-tab" data-view="learn">ğŸ“– å­¦ã¶</button>
    </nav>

    <!-- View Containers -->
    <div id="view-home" class="app-view active">
      <main class="container" style="margin-top: 24px;">
        <section class="hero" style="padding: 64px 16px; text-align: center; background: radial-gradient(1200px 600px at 50% -10%, rgba(68,147,248,.18), transparent), linear-gradient(to bottom, rgba(124,58,237,.10), transparent);">
          <div>
            <h2 style="font-size: 36px; margin: 0 0 12px;">AdventureGamePage Studio</h2>
            <p class="muted" style="margin: 0 0 20px; font-size: 16px;">åˆ†å²ã‚·ãƒŠãƒªã‚ªã‚’è¨­è¨ˆãƒ»ç®¡ç†ãƒ»æ¤œè¨¼ã™ã‚‹ãŸã‚ã®å†…è£½ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã€‚</p>
            <div style="display: inline-flex; gap: 8px; flex-wrap: wrap;">
              <button class="btn btn-accent" data-view="learn">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</button>
              <button class="btn" data-view="admin">ã‚¨ãƒ‡ã‚£ã‚¿ã‚’èµ·å‹•</button>
              <button class="btn" data-view="play">ãƒ—ãƒ¬ã‚¤ãƒ†ã‚¹ãƒˆ</button>
            </div>
          </div>
        </section>

        <section class="container" style="margin-top: 24px;">
          <div class="card" style="margin-bottom: 16px;">
            <h3>ã‚³ã‚¢æ©Ÿèƒ½</h3>
            <div style="display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
              <div class="card"><strong>ãƒãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹</strong><br/><span class="muted">åˆ†å²ãƒ»æ¡ä»¶ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ç‰©èªã‚’è¨­è¨ˆ</span></div>
              <div class="card"><strong>å³æ™‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</strong><br/><span class="muted">ä¿å­˜â†’ãƒ—ãƒ¬ã‚¤ã§å³ãƒ†ã‚¹ãƒˆ</span></div>
              <div class="card"><strong>æ‹¡å¼µå¯èƒ½</strong><br/><span class="muted">ãƒ†ãƒ¼ãƒãƒ»ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§é€²åŒ–</span></div>
            </div>
          </div>
          <div class="card">
            <h3>ã¯ã˜ã‚ã‚‹</h3>
            <p class="muted">åˆã‚ã¦ã®æ–¹ã¯ã€Œå­¦ã¶ã€ã‹ã‚‰ã€‚å®Ÿä¾‹ã¨ã¨ã‚‚ã«æœ€çŸ­ã§åˆ¶ä½œãƒ•ãƒ­ãƒ¼ã‚’ä½“é¨“ã§ãã¾ã™ã€‚</p>
            <div style="display:flex; gap: 8px;">
              <button class="btn btn-primary" data-view="learn">ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ã‚‹</button>
              <button class="btn" data-view="admin">åŸ·ç­†ã‚’é–‹å§‹</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="view-features" class="app-view">
      <div class="loading-indicator">æ©Ÿèƒ½ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div id="view-play" class="app-view">
      <div class="loading-indicator">ãƒ—ãƒ¬ã‚¤ç”»é¢ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div id="view-admin" class="app-view">
      <div class="loading-indicator">ç®¡ç†ç”»é¢ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div id="view-learn" class="app-view">
      <div class="loading-indicator">å­¦ç¿’ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div id="theme-panel" class="theme-panel" hidden></div>

    <script src="scripts/storage.js"></script>
    <script src="scripts/themeUtils.js"></script>
    <script src="scripts/themeUIManager.js"></script>
    <script src="scripts/themeLogicManager.js"></script>
    <script src="scripts/theme.js"></script>
    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- App Router Script -->
    <script>
      (function() {
        // Replace emoji with Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
          if (window.lucide) {
            const iconMap = {
              'ğŸ ': 'home',
              'âœ¨': 'sparkles',
              'ğŸ®': 'gamepad-2',
              'âœï¸': 'edit',
              'ğŸ“–': 'book-open'
            };
            document.querySelectorAll('.app-tab').forEach(tab => {
              const text = tab.textContent;
              const emoji = text.charAt(0);
              const label = text.slice(1).trim();
              if (iconMap[emoji]) {
                tab.innerHTML = '';
                const icon = window.lucide.createIcon(iconMap[emoji], { size: 16 });
                tab.appendChild(icon);
                tab.appendChild(document.createTextNode(' ' + label));
              }
            });
          }
        });
      })();
    </script>
    <script>
      (function() {
        const views = {
          home: null, // Already loaded
          features: 'features.html',
          play: 'play.html',
          admin: 'admin.html',
          learn: 'learn.html'
        };

        const loadedViews = new Set(['home']);

        // Tab switching
        document.querySelectorAll('.app-tab, [data-view]').forEach(button => {
          button.addEventListener('click', async (e) => {
            const viewName = e.target.getAttribute('data-view');
            if (!viewName) return;

            // Update active tab
            document.querySelectorAll('.app-tab').forEach(tab => {
              tab.classList.toggle('active', tab.getAttribute('data-view') === viewName);
            });

            // Update active view
            document.querySelectorAll('.app-view').forEach(view => {
              view.classList.remove('active');
            });

            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
              targetView.classList.add('active');
            }

            // Load view content if not already loaded
            if (!loadedViews.has(viewName) && views[viewName]) {
              try {
                const response = await fetch(views[viewName]);
                const html = await response.text();
                
                // Parse HTML and extract body content
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const main = doc.querySelector('main') || doc.body;
                
                // Insert content
                targetView.innerHTML = '';
                targetView.appendChild(main.cloneNode(true));
                
                // Execute scripts from the loaded page
                const scripts = doc.querySelectorAll('script');
                scripts.forEach(script => {
                  if (script.src) {
                    const newScript = document.createElement('script');
                    newScript.src = script.src;
                    document.body.appendChild(newScript);
                  } else if (script.textContent) {
                    try {
                      eval(script.textContent);
                    } catch (err) {
                      console.warn('Script execution error:', err);
                    }
                  }
                });
                
                loadedViews.add(viewName);
              } catch (error) {
                console.error('Failed to load view:', error);
                targetView.innerHTML = '<div class="container" style="margin-top: 40px;"><div class="card"><p class="muted">ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p></div></div>';
              }
            }

            // Update URL hash
            window.location.hash = viewName;
          });
        });

        // Handle initial hash
        window.addEventListener('DOMContentLoaded', () => {
          const hash = window.location.hash.slice(1);
          if (hash && views.hasOwnProperty(hash)) {
            const tab = document.querySelector(`.app-tab[data-view="${hash}"]`);
            if (tab) tab.click();
          }
        });

        // Handle hash changes
        window.addEventListener('hashchange', () => {
          const hash = window.location.hash.slice(1);
          if (hash && views.hasOwnProperty(hash)) {
            const tab = document.querySelector(`.app-tab[data-view="${hash}"]`);
            if (tab) tab.click();
          }
        });
      })();
    </script>
  </body>
</html>
